<div class="profile-container">
  <div class="profile-box">
    <h2>User Profile</h2>
    <p class="profile-subtitle">Manage your account details</p>

    <!-- Loading State -->
    <div *ngIf="loading" class="loading">
      Loading profile data...
    </div>

    <!-- Error State -->
    <div *ngIf="error" class="error">
      {{ error }}
    </div>

    <!-- Profile Information -->
    <div class="profile-info" *ngIf="user && !loading">
      <div class="profile-picture">
        <img [src]="profilePicture" alt="Profile Picture" *ngIf="profilePicture" />
        <div class="profile-placeholder" *ngIf="!profilePicture">
          {{ user.fullName.charAt(0) }}
        </div>
        <input type="file" (change)="onFileChange($event)" accept="image/*" id="profilePicInput" hidden />
        <label for="profilePicInput" class="profile-upload-btn">Upload Picture</label>
      </div>

      <div class="profile-user-details">
        <div class="profile-detail-group">
          <label>Full Name:</label>
          <span>{{ user.fullName }}</span>
        </div>
        <div class="profile-detail-group">
          <label>Email:</label>
          <span>{{ user.email }}</span>
        </div>
        <div class="profile-detail-group">
          <label>Telephone:</label>
          <span>{{ user.telephone }}</span>
        </div>
        <div class="profile-detail-group">
          <label>Role:</label>
          <span>{{ user.role }}</span>
        </div>
        <div class="profile-detail-group">
          <label>Email Verified:</label>
          <span>{{ user.isEmailVerified ? 'Yes' : 'No' }}</span>
        </div>
      </div>
    </div>

    <!-- Edit/Delete Buttons -->
    <div class="profile-action-buttons" *ngIf="user && !loading">
      <button (click)="toggleEditMode()" class="profile-edit-btn">
        {{ editMode ? 'Save' : 'Edit Profile' }}
      </button>
      <button (click)="deleteProfile()" class="profile-delete-btn">Delete Profile</button>
    </div>

    <!-- Edit Form (Visible when editMode is true) -->
    <form [formGroup]="profileForm" (ngSubmit)="saveProfile()" *ngIf="editMode && user">
      <div class="profile-form-group">
        <label for="fullName">Full Name</label>
        <input type="text" id="fullName" formControlName="fullName" placeholder="Enter your full name" />
        <div *ngIf="profileForm.get('fullName')?.touched && profileForm.get('fullName')?.invalid" class="profile-error">
          Full name is required
        </div>
      </div>

      <div class="profile-form-group">
        <label for="email">Email Address</label>
        <input type="email" id="email" formControlName="email" placeholder="Enter your email" />
        <div *ngIf="profileForm.get('email')?.touched && profileForm.get('email')?.invalid" class="profile-error">
          <div *ngIf="profileForm.get('email')?.errors?.['required']">Email is required</div>
          <div *ngIf="profileForm.get('email')?.errors?.['email']">Please enter a valid email address</div>
        </div>
      </div>

      <div class="profile-form-group">
        <label for="telephone">Telephone Number</label>
        <input type="tel" id="telephone" formControlName="telephone" placeholder="Enter your 10-digit telephone number" />
        <div *ngIf="profileForm.get('telephone')?.touched && profileForm.get('telephone')?.invalid" class="profile-error">
          <div *ngIf="profileForm.get('telephone')?.errors?.['required']">Telephone number is required</div>
          <div *ngIf="profileForm.get('telephone')?.errors?.['pattern']">Please enter a valid 10-digit phone number</div>
        </div>
      </div>
    </form>

    <!-- Reset Password Section -->
    <div class="profile-reset-password-section" *ngIf="user && !loading">
      <h3>Reset Password</h3>
      <form [formGroup]="resetPasswordForm" (ngSubmit)="resetPassword()">
        <div class="profile-form-group">
          <label for="currentPassword">Current Password</label>
          <input type="password" id="currentPassword" formControlName="currentPassword" placeholder="Enter current password" />
          <div *ngIf="resetPasswordForm.get('currentPassword')?.touched && resetPasswordForm.get('currentPassword')?.invalid" class="profile-error">
            Current password is required
          </div>
        </div>

        <div class="profile-form-group">
          <label for="newPassword">New Password</label>
          <input type="password" id="newPassword" formControlName="newPassword" placeholder="Enter new password" />
          <div *ngIf="resetPasswordForm.get('newPassword')?.touched && resetPasswordForm.get('newPassword')?.invalid" class="profile-error">
            New password is required
          </div>
        </div>

        <div class="profile-form-group">
          <label for="confirmNewPassword">Confirm New Password</label>
          <input type="password" id="confirmNewPassword" formControlName="confirmNewPassword" placeholder="Confirm new password" />
          <div *ngIf="resetPasswordForm.get('confirmNewPassword')?.touched && resetPasswordForm.get('confirmNewPassword')?.invalid" class="profile-error">
            Please confirm your new password
          </div>
          <div *ngIf="resetPasswordForm.errors?.['mismatch'] && resetPasswordForm.get('confirmNewPassword')?.touched" class="profile-error">
            Passwords do not match
          </div>
        </div>

        <button type="submit" [disabled]="resetPasswordForm.invalid">Reset Password</button>
      </form>
    </div>
  </div>
</div>